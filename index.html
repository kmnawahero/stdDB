<!DOCTYPE html>
<html>
<head>
  <title>Add Student</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    body { font-family: Arial; text-align:center; }
    input { margin:8px; padding:6px; }
    button { padding:8px 15px; margin:8px; cursor:pointer; }
  </style>
</head>
<body>

<h2>Add Student</h2>

<input type="text" id="name" placeholder="Student Name"><br>
<input type="text" id="class" placeholder="Class"><br>
<input type="text" id="room_no" placeholder="Room No"><br>
<input type="file" id="photo" accept="image/*"><br>

<button onclick="addStudent()">Add Student</button>
<button onclick="goToView()">View Students</button>

<script>
const supabaseUrl = "https://nqobmiqnwdldranpyxsl.supabase.co";
const supabaseKey = "sb_publishable_eQReGHybx0Oj9G65eqWn-w_x_OjsbWB";

const client = supabase.createClient(supabaseUrl, supabaseKey);

// Compress Image
function compressImage(file){
  return new Promise((resolve)=>{
    const reader = new FileReader();
    reader.onload = function(event){
      const img = new Image();
      img.onload = function(){
        const canvas = document.createElement("canvas");
        const maxWidth = 200;
        const scaleSize = maxWidth / img.width;

        canvas.width = maxWidth;
        canvas.height = img.height * scaleSize;

        const ctx = canvas.getContext("2d");
        ctx.drawImage(img, 0, 0, canvas.width, canvas.height);

        resolve(canvas.toDataURL("image/jpeg", 0.6));
      };
      img.src = event.target.result;
    };
    reader.readAsDataURL(file);
  });
}

window.addStudent = async function() {

  const name = document.getElementById("name").value.trim();
  const studentClass = document.getElementById("class").value.trim();
  const roomNo = document.getElementById("room_no").value.trim();
  const photoFile = document.getElementById("photo").files[0];

  if(!name || !studentClass || !roomNo || !photoFile){
    alert("Please fill all fields!");
    return;
  }

  const photoBase64 = await compressImage(photoFile);

  const { error } = await client
    .from("students")
    .insert([
      {
        name: name,
        class: studentClass,
        room_no: roomNo,
        photo_url: photoBase64,
        status: "present"
      }
    ]);

  if(error){
    console.log(error);
    alert("Error adding student");
  } else {
    alert("Student Added Successfully!");
    document.querySelectorAll("input").forEach(i=>i.value="");
  }
}

function goToView(){
  window.location.href = "view-students.html";
}
</script>

</body>
</html>



